{% include analytics.download.html %}

<div id="download"></div>

<script>

(function(){

    function getQueryStringValue (key) {
      return decodeURIComponent( window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1" ) );
    }

    var booktype = getQueryStringValue("booktype")
    var filetype = getQueryStringValue("filetype")

    var bookfile = "{{ site.data.theme.filename.book }}." + filetype
    var redirect_path = "{{ site.baseurl }}/books/" + booktype + "/{{ page.bookid }}/" + bookfile

    console.log( redirect_path )

    newlink = document.createElement('a');
    newlink.setAttribute('href', redirect_path );
    newlink.setAttribute('download', "{{ page.bookid }}." + filetype );
    newlink.click()

    window.history.back();
    // Simulate a mouse click:
    // window.location.href = "http://www.w3schools.com";
    // Simulate an HTTP redirect:
    // window.location.replace( redirect_path );

})();

</script>
